!function(){var i=window.jwplayer("container"),t=function(){function t(i,t){this.internalPlayerApi=i,this.config=t,this.imaNativePlugin=window.ImaNativePlugin,this.instreamInstance=null,this.playlistItem=null,this.position=0,this.vmapUrl=null,this.adSchedule=null,this.prerolls=null,this.rawMidrolls=null,this.midrolls=null,this.playedAds=null,this.postrolls=null,this.isAdRequestPending=!1,this.oldPlayAd=null,this.oldPauseAd=null,this.oldSkipAd=null,i.on("playlist",this.handlePlaylist,this),i.on("mute",this.handleMute,this),i.on("playlistItem",this.handlePlaylistItem,this),i.on("complete",this.handleComplete,this),i.on("error",this.destroy,this),i.on("remove",this.destroy,this)}var s=t.prototype;return s.handlePlaylist=function(i){this.init(),this.config.advertising&&"googima_sdks"==this.config.advertising.client&&(this.oldPlayAd=this.internalPlayerApi.playAd,this.oldPauseAd=this.internalPlayerApi.pauseAd,this.oldSkipAd=this.internalPlayerApi.skipAd,this.internalPlayerApi.playAd=this.playAd.bind(this),this.internalPlayerApi.pauseAd=this.pauseAd.bind(this),this.internalPlayerApi.skipAd=this.skipAd.bind(this))},s.handleMute=function(i){this.instreamInstance&&this.imaNativePlugin.mute(i.mute)},s.handlePlaylistItem=function(t){if(this.init(),this.config.advertising&&"googima_sdks"==this.config.advertising.client){var s=t.item,e=s.imaSdkSettings||this.config.advertising.imaSdkSettings,n=e?JSON.stringify(e):null,l=this.internalPlayerApi.getConfig().key,r=new i.utils.key(l);this.imaNativePlugin.init(n,r.token()),this.vmapUrl=this.config.advertising.tag,this.adSchedule=s.adschedule||this.config.advertising.schedule,this.adSchedule&&(this.prerolls=this.adSchedule.filter((function(i){return"pre"===i.offset})),this.postrolls=this.adSchedule.filter((function(i){return"post"===i.offset})),this.midrolls=this.adSchedule.filter((function(i){return"pre"!==i.offset&&"post"!==i.offset})),this.playedAds=[]),(this.prerolls&&this.prerolls.length>0||this.vmapUrl)&&this.internalPlayerApi.once("beforePlay",this.handleBeforePlay,this);var o=this.midrolls&&this.midrolls.length>0,h=this.postrolls&&this.postrolls.length>0;o&&(this.internalPlayerApi.once("bufferChange",this.scheduleMidrolls,this),this.internalPlayerApi.on("seeked",this.handleSeeked,this)),h&&this.internalPlayerApi.on("beforeComplete",this.handleBeforeComplete,this),(o||h)&&this.internalPlayerApi.on("time",this.handleTime,this)}},s.handleComplete=function(i){this.imaNativePlugin.destroy()},s.handleBeforePlay=function(){this.internalPlayerApi.set("state","buffering"),this.blockContent(),this.prerolls&&this.prerolls.length>0?this.requestAds(this.prerolls,!0):this.vmapUrl&&this.imaNativePlugin.requestVmap(this.vmapUrl)},s.handleTime=function(i){var t=i.position;this.position=t;var s=this.midrolls&&this.midrolls.length>0,e=this.postrolls&&this.postrolls.length>0;s||e?(s&&this.handleTimeForMidrolls(i),this.isAdRequestPending||e&&(this.handleTimeForPostrolls(i),this.isAdRequestPending&&this.internalPlayerApi.off("time",this.handleTime,this))):this.internalPlayerApi.off("time",this.handleTime,this)},s.handleTimeForMidrolls=function(i){var t=i.position;if(!(this.midrolls[0].offset>t+10||this.midrolls[0].offset>t&&this.isAdRequestPending)){if(this.midrolls[0].offset>t&&!this.isAdRequestPending){var s=(e=this.midrolls.filter((function(i){return i.offset<=t+10}))).reduce((function(i,t){return i.offset<t.offset?i:t})).offset;return e=e.filter((function(i){return i.offset==s})),void this.requestAds(e,!1)}var e=this.midrolls.filter((function(i){return i.offset<=t}));this.midrolls=this.midrolls.filter((function(i){return!e.includes(i)})),this.requestAds(e,!0)}},s.handleTimeForPostrolls=function(i){this.postrolls&&0!=this.postrolls.length&&i.duration-i.position<10&&this.requestAds(this.postrolls,!1)},s.handleSeeked=function(i){i.position>=this.position?this.handleSeekedForward(i):this.handleSeekedBackward(i),this.position=i.position},s.handleSeekedForward=function(i){var t=i.position,s=this.midrolls.filter((function(i){return i.offset<=t}));if(0!=s.length){this.midrolls=this.midrolls.filter((function(i){return!s.includes(i)}));var e=s.reduce((function(i,t){return i.offset>t.offset?i:t})).offset;s=s.filter((function(i){if(i.offset==e)return i})),this.blockContent(),this.requestAds(s,!0)}},s.handleSeekedBackward=function(i){var t=i.position,s=this,e=this.rawMidrolls.filter((function(i){return i.offset>=t&&!s.playedAds.includes(i)&&!s.midrolls.includes(i)}));this.midrolls.push.apply(this.midrolls,e),this.midrolls.sort((function(i,t){return i.offset-t.offset})),this.midrolls&&this.midrolls.length>0&&this.internalPlayerApi.on("time",this.handleTime,this)},s.handleBeforeComplete=function(){this.blockContent(),this.requestAds(this.postrolls,!0)},s.blockContent=function(){this.instreamInstance||(this.instreamInstance=this.internalPlayerApi.createInstream(),this.instreamInstance.init())},s.unblockContent=function(){this.instreamInstance&&(this.instreamInstance.destroy(),this.instreamInstance=null,this.isAdRequestPending=!1)},s.init=function(){this.instreamInstance&&this.instreamInstance.destroy(),this.instreamInstance=null,this.playlistItem=null,this.position=0,this.vmapUrl=null,this.adSchedule=null,this.prerolls=null,this.rawMidrolls=null,this.midrolls=null,this.playedAds=null,this.postrolls=null,this.isAdRequestPending=!1,this.imaNativePlugin.destroy()},s.playAd=function(i){this.imaNativePlugin.playAd(i)},s.pauseAd=function(i){this.imaNativePlugin.pauseAd(i)},s.skipAd=function(){this.imaNativePlugin.skipAd()},s.requestAds=function(i,t){this.isAdRequestPending=!0,t&&this.playedAds.push.apply(this.playedAds,i),this.imaNativePlugin.requestAds(JSON.stringify(i),t)},s.destroy=function(){this.oldPlayAd&&(this.internalPlayerApi.playAd=this.oldPlayAd,this.internalPlayerApi.pauseAd=this.oldPauseAd,this.internalPlayerApi.skipAd=this.oldSkipAd),this.internalPlayerApi.off(null,null,this),this.imaNativePlugin.destroy()},s.scheduleMidrolls=function(i){var t=this.midrolls.filter((function(i){return"string"==typeof i.offset&&i.offset.endsWith("%")}));t.forEach((function(t){var s=parseFloat(t.offset.replace("%",""))/100;t.offset=i.duration*s})),(t=this.midrolls.filter((function(i){return"string"==typeof i.offset&&i.offset.includes(":")}))).forEach((function(i){var t=i.offset.split(":");i.offset=3600*+t[0]+60*+t[1]+ +t[2]})),(t=this.midrolls.filter((function(i){return"string"==typeof i.offset}))).forEach((function(i){i.offset=parseFloat(i.offset)})),this.midrolls.sort((function(i,t){return i.offset-t.offset})),this.rawMidrolls=this.midrolls.slice(0);var s=this.midrolls.map((function(i){return i.offset}));this.imaNativePlugin.setCues(s)},t}();i.registerPlugin("imaPluginSdk","8.0",t)}();
